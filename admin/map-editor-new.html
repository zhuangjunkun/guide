<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å›¾æ ‡è®°ç¼–è¾‘å™¨</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/map.css">
    <style>
        /* ç¼–è¾‘å™¨ç‰¹æœ‰æ ·å¼ */
        .editor-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
        }

        .editor-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 280px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1001;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        /* è°ƒæ•´åœ°å›¾å®¹å™¨å¤§å° */
        .map-container {
            height: 100vh;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .map-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .map-wrapper.dragging {
            cursor: grabbing;
        }

        .map-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: center center;
        }

        .map-image {
            max-width: none;
            max-height: none;
            width: auto;
            height: 80vh;
            object-fit: contain;
        }

        .panel-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .panel-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .panel-content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            min-height: 80px;
            resize: vertical;
            box-sizing: border-box;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* ç¼–è¾‘æ¨¡å¼ä¸‹çš„æ ‡è®°æ ·å¼ */
        .marker.editing {
            cursor: move;
            transform: translate(-50%, -100%) scale(1.2);
            z-index: 100;
        }

        .marker.editing .marker-icon {
            background: #e74c3c;
            border-color: #c0392b;
        }

        .marker.editing .marker-pulse {
            background: rgba(231, 76, 60, 0.3);
        }

        /* ç¼–è¾‘å·¥å…·æ  */
        .editor-toolbar {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 12px;
            z-index: 1001;
            width: 140px;
        }

        .toolbar-btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 8px;
            border: none;
            border-radius: 6px;
            background: #f8f9fa;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            white-space: nowrap;
        }

        .toolbar-btn:last-child {
            margin-bottom: 0;
        }

        .toolbar-btn:hover {
            background: #e9ecef;
        }

        .toolbar-btn.active {
            background: #3498db;
            color: white;
        }

        /* åæ ‡æ˜¾ç¤º */
        .coordinate-display {
            position: fixed;
            bottom: 20px;
            left: 310px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1001;
        }

        /* ç½‘æ ¼è¾…åŠ©çº¿ */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.3;
            background-image: 
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            display: none;
        }

        .grid-overlay.show {
            display: block;
        }

        /* æ™¯ç‚¹åˆ—è¡¨ */
        .attractions-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .attraction-item {
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .attraction-item:hover {
            background: #f8f9fa;
            border-color: #3498db;
        }

        .attraction-item.selected {
            background: #e3f2fd;
            border-color: #3498db;
        }

        .attraction-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .attraction-coords {
            font-size: 12px;
            color: #666;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- åœ°å›¾å®¹å™¨ - å¤ç”¨H5ç«¯çš„ç»“æ„ -->
    <div class="map-container">
        <!-- æ¸å˜èƒŒæ™¯ -->
        <div class="map-background"></div>
        
        <!-- æ‰‹ç»˜åœ°å›¾ -->
        <div class="map-wrapper" id="mapWrapper">
            <div class="map-content" id="mapContent">
                <!-- ç½‘æ ¼è¾…åŠ©çº¿ -->
                <div class="grid-overlay" id="gridOverlay"></div>
                
                <!-- åœ°å›¾å›¾ç‰‡ -->
                <img class="map-image" id="mapImage" src="../assets/map.jpg" alt="æ—…æ¸¸åœ°å›¾" draggable="false">
                
                <!-- æ™¯ç‚¹æ ‡è®° - åŠ¨æ€ç”Ÿæˆ -->
                <div id="markersContainer">
                    <!-- æ ‡è®°å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
        </div>

        <!-- åœ°å›¾æ§åˆ¶æŒ‰é’® - å¤ç”¨H5ç«¯çš„æ§åˆ¶ -->
        <div class="map-controls">
            <button class="control-btn" id="locateBtn" title="é‡ç½®è§†å›¾">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                </svg>
            </button>
            <button class="control-btn" id="zoomInBtn" title="æ”¾å¤§">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
            </button>
            <button class="control-btn" id="zoomOutBtn" title="ç¼©å°">
                <svg viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M19 13H5v-2h14v2z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- ç¼–è¾‘å·¥å…·æ  -->
    <div class="editor-toolbar">
        <button class="toolbar-btn" id="selectModeBtn">ğŸ¯ é€‰æ‹©æ¨¡å¼</button>
        <button class="toolbar-btn" id="addModeBtn">â• æ·»åŠ æ ‡è®°</button>
        <button class="toolbar-btn" id="gridToggleBtn">ğŸ“ æ˜¾ç¤ºç½‘æ ¼</button>
        <button class="toolbar-btn" id="saveBtn">ğŸ’¾ ä¿å­˜æ›´æ”¹</button>
        <button class="toolbar-btn" id="previewBtn">ğŸ‘ï¸ é¢„è§ˆH5</button>
        <button class="toolbar-btn" id="backBtn">ğŸ  è¿”å›åå°</button>
    </div>

    <!-- æ™¯ç‚¹åˆ—è¡¨é¢æ¿ -->
    <div class="editor-panel">
        <div class="panel-header">
            <h3 class="panel-title">æ™¯ç‚¹ç®¡ç†</h3>
        </div>
        <div class="panel-content">
            <div class="form-group">
                <label class="form-label">æ™¯ç‚¹åˆ—è¡¨</label>
                <div class="attractions-list" id="attractionsList">
                    <!-- åŠ¨æ€åŠ è½½ -->
                </div>
            </div>
            
            <div id="editForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">æ™¯ç‚¹åç§°</label>
                    <input type="text" class="form-input" id="attractionName" placeholder="è¯·è¾“å…¥æ™¯ç‚¹åç§°">
                </div>
                
                <div class="form-group">
                    <label class="form-label">æ™¯ç‚¹æè¿°</label>
                    <textarea class="form-textarea" id="attractionDescription" placeholder="è¯·è¾“å…¥æ™¯ç‚¹æè¿°"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">å›¾ç‰‡URL</label>
                    <input type="text" class="form-input" id="attractionImage" placeholder="è¯·è¾“å…¥å›¾ç‰‡URL">
                </div>
                
                <div class="form-group">
                    <label class="form-label">åæ ‡ä½ç½®</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" class="form-input" id="attractionX" placeholder="X%" style="flex: 1;">
                        <input type="number" class="form-input" id="attractionY" placeholder="Y%" style="flex: 1;">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" id="saveAttractionBtn">ä¿å­˜</button>
                    <button class="btn btn-secondary" id="cancelEditBtn">å–æ¶ˆ</button>
                    <button class="btn btn-danger" id="deleteAttractionBtn">åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åæ ‡æ˜¾ç¤º -->
    <div class="coordinate-display" id="coordinateDisplay">
        åæ ‡: (0, 0)
    </div>

    <script src="../js/common.js"></script>
    <script>
        // åœ°å›¾ç¼–è¾‘å™¨ç±» - åŸºäºH5ç«¯çš„MapAppè¿›è¡Œæ‰©å±•
        class MapEditor {
            constructor() {
                // ç»§æ‰¿H5ç«¯çš„åœ°å›¾åŠŸèƒ½
                this.scale = 1;
                this.minScale = 0.5;
                this.maxScale = 3;
                this.translateX = 0;
                this.translateY = 0;
                this.isDragging = false;
                this.startX = 0;
                this.startY = 0;
                
                // ç¼–è¾‘å™¨ç‰¹æœ‰å±æ€§
                this.editMode = 'select'; // select, add
                this.selectedMarker = null;
                this.attractions = [];
                this.nextId = 1;
                
                this.init();
            }

            init() {
                this.loadAttractions();
                this.bindEvents();
                this.initMap();
                this.renderAttractions();
                this.updateMarkerScale();
            }

            // åŠ è½½æ™¯ç‚¹æ•°æ®
            loadAttractions() {
                // ä»localStorageæˆ–APIåŠ è½½æ•°æ®
                const saved = localStorage.getItem('attractions');
                if (saved) {
                    this.attractions = JSON.parse(saved);
                    this.nextId = Math.max(...this.attractions.map(a => a.id), 0) + 1;
                } else {
                    // é»˜è®¤æ•°æ®
                    this.attractions = [
                        {
                            id: 1,
                            name: 'è¥¿æ¹–',
                            description: 'è¥¿æ¹–ï¼Œä½äºæµ™æ±Ÿçœæ­å·å¸‚è¥¿æ¹–åŒºé¾™äº•è·¯1å·ï¼Œæ­å·å¸‚åŒºè¥¿éƒ¨ï¼Œæ™¯åŒºæ€»é¢ç§¯49å¹³æ–¹åƒç±³ã€‚',
                            image: 'https://picsum.photos/300/150?random=11',
                            x: 25,
                            y: 30,
                            coordinates: { lat: 30.2741, lng: 120.1551 }
                        },
                        {
                            id: 2,
                            name: 'çµéšå¯º',
                            description: 'çµéšå¯ºï¼Œåˆåäº‘æ—å¯ºï¼Œä½äºæµ™æ±Ÿçœæ­å·å¸‚ï¼ŒèƒŒé åŒ—é«˜å³°ï¼Œé¢æœé£æ¥å³°ã€‚',
                            image: 'https://picsum.photos/300/150?random=12',
                            x: 45,
                            y: 25,
                            coordinates: { lat: 30.2408, lng: 120.1014 }
                        },
                        {
                            id: 3,
                            name: 'å®‹åŸ',
                            description: 'æ­å·å®‹åŸæ™¯åŒºæ˜¯ä¸­å›½å¤§é™†äººæ°”æœ€æ—ºçš„ä¸»é¢˜å…¬å›­ï¼Œå¹´æ¸¸å®¢é€¾700ä¸‡äººæ¬¡ã€‚',
                            image: 'https://picsum.photos/300/150?random=13',
                            x: 60,
                            y: 45,
                            coordinates: { lat: 30.1957, lng: 120.0778 }
                        },
                        {
                            id: 4,
                            name: 'æ²³åŠè¡—',
                            description: 'æ²³åŠè¡—ä½äºå´å±±è„šä¸‹ï¼Œæ˜¯æ¸…æ²³åŠçš„ä¸€éƒ¨åˆ†ï¼Œå±äºæ­å·è€åŸåŒºã€‚',
                            image: 'https://picsum.photos/300/150?random=14',
                            x: 35,
                            y: 60,
                            coordinates: { lat: 30.2467, lng: 120.1707 }
                        }
                    ];
                }
            }

            // ä¿å­˜æ™¯ç‚¹æ•°æ®
            saveAttractions() {
                localStorage.setItem('attractions', JSON.stringify(this.attractions));
                alert('ä¿å­˜æˆåŠŸï¼');
            }

            // æ¸²æŸ“æ™¯ç‚¹æ ‡è®°
            renderAttractions() {
                const container = document.getElementById('markersContainer');
                container.innerHTML = '';
                
                this.attractions.forEach(attraction => {
                    const marker = this.createMarker(attraction);
                    container.appendChild(marker);
                });
                
                this.renderAttractionsList();
            }

            // åˆ›å»ºæ ‡è®°å…ƒç´ 
            createMarker(attraction) {
                const marker = document.createElement('div');
                marker.className = 'marker';
                marker.dataset.id = attraction.id;
                marker.style.left = attraction.x + '%';
                marker.style.top = attraction.y + '%';
                
                marker.innerHTML = `
                    <div class="marker-pulse"></div>
                    <div class="marker-icon"></div>
                `;
                
                return marker;
            }

            // æ¸²æŸ“æ™¯ç‚¹åˆ—è¡¨
            renderAttractionsList() {
                const list = document.getElementById('attractionsList');
                list.innerHTML = '';
                
                this.attractions.forEach(attraction => {
                    const item = document.createElement('div');
                    item.className = 'attraction-item';
                    item.dataset.id = attraction.id;
                    item.innerHTML = `
                        <div class="attraction-name">${attraction.name}</div>
                        <div class="attraction-coords">(${attraction.x}%, ${attraction.y}%)</div>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.selectAttraction(attraction.id);
                    });
                    
                    list.appendChild(item);
                });
            }

            // é€‰æ‹©æ™¯ç‚¹
            selectAttraction(id) {
                this.selectedMarker = this.attractions.find(a => a.id === id);
                
                // æ›´æ–°UI
                document.querySelectorAll('.attraction-item').forEach(item => {
                    item.classList.remove('selected');
                });
                document.querySelector(`[data-id="${id}"]`).classList.add('selected');
                
                // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
                this.showEditForm();
            }

            // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
            showEditForm() {
                if (!this.selectedMarker) return;
                
                const form = document.getElementById('editForm');
                form.style.display = 'block';
                
                document.getElementById('attractionName').value = this.selectedMarker.name;
                document.getElementById('attractionDescription').value = this.selectedMarker.description;
                document.getElementById('attractionImage').value = this.selectedMarker.image;
                document.getElementById('attractionX').value = this.selectedMarker.x;
                document.getElementById('attractionY').value = this.selectedMarker.y;
            }

            // éšè—ç¼–è¾‘è¡¨å•
            hideEditForm() {
                document.getElementById('editForm').style.display = 'none';
                this.selectedMarker = null;
                
                document.querySelectorAll('.attraction-item').forEach(item => {
                    item.classList.remove('selected');
                });
            }

            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                const mapWrapper = document.getElementById('mapWrapper');
                const mapContent = document.getElementById('mapContent');
                
                // åœ°å›¾æ‹–æ‹½å’Œç¼©æ”¾äº‹ä»¶ï¼ˆå¤ç”¨H5ç«¯é€»è¾‘ï¼‰
                mapWrapper.addEventListener('mousedown', this.handleMouseDown.bind(this));
                document.addEventListener('mousemove', this.handleMouseMove.bind(this));
                document.addEventListener('mouseup', this.handleMouseUp.bind(this));
                mapWrapper.addEventListener('wheel', this.handleWheel.bind(this), { passive: false });
                
                // ç¼©æ”¾æ§åˆ¶
                document.getElementById('zoomInBtn').addEventListener('click', () => this.zoomIn());
                document.getElementById('zoomOutBtn').addEventListener('click', () => this.zoomOut());
                document.getElementById('locateBtn').addEventListener('click', () => this.resetView());
                
                // ç¼–è¾‘å·¥å…·æ 
                document.getElementById('selectModeBtn').addEventListener('click', () => this.setEditMode('select'));
                document.getElementById('addModeBtn').addEventListener('click', () => this.setEditMode('add'));
                document.getElementById('gridToggleBtn').addEventListener('click', () => this.toggleGrid());
                document.getElementById('saveBtn').addEventListener('click', () => this.saveAttractions());
                document.getElementById('previewBtn').addEventListener('click', () => this.previewH5());
                document.getElementById('backBtn').addEventListener('click', () => this.goBack());
                
                // ç¼–è¾‘è¡¨å•
                document.getElementById('saveAttractionBtn').addEventListener('click', () => this.saveAttraction());
                document.getElementById('cancelEditBtn').addEventListener('click', () => this.hideEditForm());
                document.getElementById('deleteAttractionBtn').addEventListener('click', () => this.deleteAttraction());
                
                // åœ°å›¾ç‚¹å‡»äº‹ä»¶
                mapWrapper.addEventListener('click', this.handleMapClick.bind(this));
                
                // é¼ æ ‡ç§»åŠ¨æ˜¾ç¤ºåæ ‡
                mapWrapper.addEventListener('mousemove', this.updateCoordinateDisplay.bind(this));
            }

            // è®¾ç½®ç¼–è¾‘æ¨¡å¼
            setEditMode(mode) {
                this.editMode = mode;
                
                document.querySelectorAll('.toolbar-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (mode === 'select') {
                    document.getElementById('selectModeBtn').classList.add('active');
                } else if (mode === 'add') {
                    document.getElementById('addModeBtn').classList.add('active');
                }
            }

            // å¤„ç†åœ°å›¾ç‚¹å‡»
            handleMapClick(e) {
                if (this.editMode === 'add' && !this.isDragging) {
                    const rect = e.currentTarget.getBoundingClientRect();
                    const x = ((e.clientX - rect.left - this.translateX) / this.scale / rect.width) * 100;
                    const y = ((e.clientY - rect.top - this.translateY) / this.scale / rect.height) * 100;
                    
                    this.addAttraction(x, y);
                }
            }

            // æ·»åŠ æ™¯ç‚¹
            addAttraction(x, y) {
                const newAttraction = {
                    id: this.nextId++,
                    name: `æ–°æ™¯ç‚¹${this.nextId - 1}`,
                    description: 'è¯·ç¼–è¾‘æ™¯ç‚¹æè¿°',
                    image: 'https://picsum.photos/300/150?random=' + (this.nextId - 1),
                    x: Math.round(x * 10) / 10,
                    y: Math.round(y * 10) / 10,
                    coordinates: { lat: 30.2741, lng: 120.1551 }
                };
                
                this.attractions.push(newAttraction);
                this.renderAttractions();
                this.selectAttraction(newAttraction.id);
            }

            // ä¿å­˜æ™¯ç‚¹
            saveAttraction() {
                if (!this.selectedMarker) return;
                
                const name = document.getElementById('attractionName').value;
                const description = document.getElementById('attractionDescription').value;
                const image = document.getElementById('attractionImage').value;
                const x = parseFloat(document.getElementById('attractionX').value);
                const y = parseFloat(document.getElementById('attractionY').value);
                
                if (!name || isNaN(x) || isNaN(y)) {
                    alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                    return;
                }
                
                this.selectedMarker.name = name;
                this.selectedMarker.description = description;
                this.selectedMarker.image = image;
                this.selectedMarker.x = x;
                this.selectedMarker.y = y;
                
                this.renderAttractions();
                this.hideEditForm();
            }

            // åˆ é™¤æ™¯ç‚¹
            deleteAttraction() {
                if (!this.selectedMarker) return;
                
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ™¯ç‚¹å—ï¼Ÿ')) {
                    this.attractions = this.attractions.filter(a => a.id !== this.selectedMarker.id);
                    this.renderAttractions();
                    this.hideEditForm();
                }
            }

            // åˆ‡æ¢ç½‘æ ¼æ˜¾ç¤º
            toggleGrid() {
                const grid = document.getElementById('gridOverlay');
                grid.classList.toggle('show');
            }

            // æ›´æ–°åæ ‡æ˜¾ç¤º
            updateCoordinateDisplay(e) {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = ((e.clientX - rect.left - this.translateX) / this.scale / rect.width) * 100;
                const y = ((e.clientY - rect.top - this.translateY) / this.scale / rect.height) * 100;
                
                document.getElementById('coordinateDisplay').textContent = 
                    `åæ ‡: (${Math.round(x * 10) / 10}%, ${Math.round(y * 10) / 10}%)`;
            }

            // é¢„è§ˆH5
            previewH5() {
                // ä¿å­˜å½“å‰æ•°æ®åˆ°H5ç«¯
                const h5Data = this.attractions.map(attraction => ({
                    id: attraction.id,
                    name: attraction.name,
                    description: attraction.description,
                    image: attraction.image,
                    coordinates: attraction.coordinates
                }));
                
                localStorage.setItem('h5_attractions', JSON.stringify(h5Data));
                window.open('../map.html', '_blank');
            }

            // è¿”å›åå°
            goBack() {
                window.location.href = '../admin/';
            }

            // åœ°å›¾æ“ä½œæ–¹æ³•ï¼ˆå¤ç”¨H5ç«¯é€»è¾‘ï¼‰
            initMap() {
                this.updateTransform();
            }

            handleMouseDown(e) {
                if (e.target.closest('.marker') || this.editMode === 'add') return;
                
                this.isDragging = true;
                this.startX = e.clientX - this.translateX;
                this.startY = e.clientY - this.translateY;
                document.getElementById('mapWrapper').classList.add('dragging');
                e.preventDefault();
            }

            handleMouseMove(e) {
                if (!this.isDragging) return;
                
                this.translateX = e.clientX - this.startX;
                this.translateY = e.clientY - this.startY;
                this.updateTransform();
                e.preventDefault();
            }

            handleMouseUp(e) {
                this.isDragging = false;
                document.getElementById('mapWrapper').classList.remove('dragging');
            }

            handleWheel(e) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -0.1 : 0.1;
                const newScale = Math.max(this.minScale, Math.min(this.maxScale, this.scale + delta));
                
                if (newScale !== this.scale) {
                    this.scale = newScale;
                    this.updateTransform();
                }
            }

            updateTransform() {
                const mapContent = document.getElementById('mapContent');
                mapContent.style.transform = `translate(${this.translateX}px, ${this.translateY}px) scale(${this.scale})`;
                this.updateMarkerScale();
            }

            updateMarkerScale() {
                const markers = document.querySelectorAll('.marker');
                const markerScale = Math.max(0.6, Math.min(1.4, 1 / this.scale));
                
                markers.forEach(marker => {
                    marker.style.transform = `translate(-50%, -100%) scale(${markerScale})`;
                });
            }

            zoomIn() {
                if (this.scale < this.maxScale) {
                    this.scale = Math.min(this.maxScale, this.scale + 0.2);
                    this.updateTransform();
                }
            }

            zoomOut() {
                if (this.scale > this.minScale) {
                    this.scale = Math.max(this.minScale, this.scale - 0.2);
                    this.updateTransform();
                }
            }

            resetView() {
                this.scale = 1;
                this.translateX = 0;
                this.translateY = 0;
                this.updateTransform();
            }
        }

        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        document.addEventListener('DOMContentLoaded', () => {
            new MapEditor();
        });
    </script>
</body>
</html>