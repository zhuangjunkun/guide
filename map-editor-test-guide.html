<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地图编辑器测试指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
            line-height: 1.6;
        }
        .header {
            background: linear-gradient(135deg, #2E8B57 0%, #20B2AA 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #2E8B57;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-step {
            background: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #2E8B57;
            border-radius: 0 8px 8px 0;
        }
        .test-step h4 {
            color: #333;
            margin: 0 0 10px 0;
        }
        .test-step p {
            margin: 5px 0;
            color: #666;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature-item {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c8e6c9;
        }
        .feature-item h4 {
            color: #2E8B57;
            margin: 0 0 8px 0;
        }
        .shortcut-key {
            background: #333;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .btn {
            background: #2E8B57;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #236B43;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🗺️ 地图编辑器测试指南</h1>
        <p>完整的功能测试和使用说明</p>
    </div>

    <div class="test-section">
        <h2>🚀 快速开始</h2>
        <div class="success">
            <strong>✅ 系统已启动</strong><br>
            确保您的开发服务器正在运行：<code>npm start</code>
        </div>
        
        <div class="test-step">
            <h4>步骤 1: 访问管理后台</h4>
            <p>打开浏览器访问：<a href="http://localhost:8080/admin" target="_blank">http://localhost:8080/admin</a></p>
        </div>
        
        <div class="test-step">
            <h4>步骤 2: 进入景点管理</h4>
            <p>在左侧菜单中点击"景点管理"</p>
        </div>
        
        <div class="test-step">
            <h4>步骤 3: 打开地图编辑器</h4>
            <p>点击页面右上角的"地图编辑器"按钮</p>
        </div>

        <a href="http://localhost:8080/admin" class="btn" target="_blank">🎯 直接打开管理后台</a>
        <a href="http://localhost:8080/admin/map-editor.html" class="btn btn-secondary" target="_blank">🗺️ 直接打开地图编辑器</a>
    </div>

    <div class="test-section">
        <h2>🎮 核心功能测试</h2>
        
        <div class="feature-list">
            <div class="feature-item">
                <h4>🖱️ 选择模式</h4>
                <p>默认模式，点击景点标记查看详细信息</p>
                <p><strong>快捷键：</strong> <span class="shortcut-key">1</span></p>
            </div>
            
            <div class="feature-item">
                <h4>➕ 添加模式</h4>
                <p>在地图上点击任意位置添加新景点</p>
                <p><strong>快捷键：</strong> <span class="shortcut-key">2</span></p>
            </div>
            
            <div class="feature-item">
                <h4>🔄 移动模式</h4>
                <p>拖拽景点标记调整位置</p>
                <p><strong>快捷键：</strong> <span class="shortcut-key">3</span></p>
            </div>
            
            <div class="feature-item">
                <h4>🔍 缩放控制</h4>
                <p>鼠标滚轮缩放，或使用工具栏按钮</p>
                <p><strong>范围：</strong> 10% - 500%</p>
            </div>
            
            <div class="feature-item">
                <h4>📐 网格系统</h4>
                <p>显示网格辅助线，支持吸附对齐</p>
                <p><strong>网格大小：</strong> 20px</p>
            </div>
            
            <div class="feature-item">
                <h4>💾 数据同步</h4>
                <p>所有操作实时同步到Supabase数据库</p>
                <p><strong>快捷键：</strong> <span class="shortcut-key">Ctrl+S</span></p>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>📋 详细测试步骤</h2>
        
        <div class="test-step">
            <h4>测试 1: 查看现有景点</h4>
            <p>1. 在左侧景点列表中查看已有的4个景点</p>
            <p>2. 点击列表中的景点项，观察地图上对应标记的高亮</p>
            <p>3. 点击地图上的标记，查看右侧属性面板</p>
            <p><strong>预期结果：</strong> 景点信息正确显示，标记位置准确</p>
        </div>
        
        <div class="test-step">
            <h4>测试 2: 添加新景点</h4>
            <p>1. 点击工具栏的"添加标记"按钮或按 <span class="shortcut-key">2</span></p>
            <p>2. 在地图空白处点击一个位置</p>
            <p>3. 在弹出的表单中填写景点信息</p>
            <p>4. 点击"保存"按钮</p>
            <p><strong>预期结果：</strong> 新景点出现在地图和列表中</p>
        </div>
        
        <div class="test-step">
            <h4>测试 3: 移动景点位置</h4>
            <p>1. 选择"移动模式"或按 <span class="shortcut-key">3</span></p>
            <p>2. 拖拽任意景点标记到新位置</p>
            <p>3. 观察坐标显示的实时更新</p>
            <p>4. 释放鼠标，检查位置是否保存</p>
            <p><strong>预期结果：</strong> 标记位置更新，坐标信息同步</p>
        </div>
        
        <div class="test-step">
            <h4>测试 4: 编辑景点信息</h4>
            <p>1. 双击任意景点标记</p>
            <p>2. 在编辑表单中修改信息</p>
            <p>3. 测试所有表单字段</p>
            <p>4. 保存并验证更改</p>
            <p><strong>预期结果：</strong> 信息更新成功，界面同步刷新</p>
        </div>
        
        <div class="test-step">
            <h4>测试 5: 地图操作</h4>
            <p>1. 使用鼠标滚轮缩放地图</p>
            <p>2. 在选择模式下拖拽地图平移</p>
            <p>3. 点击"重置视图"恢复默认</p>
            <p>4. 开启网格显示和吸附功能</p>
            <p><strong>预期结果：</strong> 地图操作流畅，视图控制正常</p>
        </div>
        
        <div class="test-step">
            <h4>测试 6: 景点状态管理</h4>
            <p>1. 在景点列表中点击眼睛图标</p>
            <p>2. 观察地图上标记的显示/隐藏</p>
            <p>3. 测试删除功能</p>
            <p>4. 确认操作的撤销和确认</p>
            <p><strong>预期结果：</strong> 状态切换正常，删除需要确认</p>
        </div>
    </div>

    <div class="test-section">
        <h2>⌨️ 键盘快捷键</h2>
        <div class="feature-list">
            <div class="feature-item">
                <h4><span class="shortcut-key">1</span> 选择模式</h4>
                <p>切换到选择模式，可以点击查看景点</p>
            </div>
            <div class="feature-item">
                <h4><span class="shortcut-key">2</span> 添加模式</h4>
                <p>切换到添加模式，点击地图添加景点</p>
            </div>
            <div class="feature-item">
                <h4><span class="shortcut-key">3</span> 移动模式</h4>
                <p>切换到移动模式，拖拽调整位置</p>
            </div>
            <div class="feature-item">
                <h4><span class="shortcut-key">ESC</span> 取消操作</h4>
                <p>取消当前操作，关闭弹窗</p>
            </div>
            <div class="feature-item">
                <h4><span class="shortcut-key">Delete</span> 删除景点</h4>
                <p>删除当前选中的景点</p>
            </div>
            <div class="feature-item">
                <h4><span class="shortcut-key">Ctrl+S</span> 保存更改</h4>
                <p>保存所有未保存的更改</p>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>🔧 故障排除</h2>
        
        <div class="warning">
            <h4>⚠️ 常见问题</h4>
            <p><strong>地图不显示：</strong> 检查images/map.svg文件是否存在</p>
            <p><strong>景点数据为空：</strong> 确认Supabase数据库连接正常</p>
            <p><strong>拖拽不响应：</strong> 确保在正确的编辑模式下操作</p>
            <p><strong>保存失败：</strong> 检查网络连接和数据库权限</p>
        </div>
        
        <div class="test-step">
            <h4>调试工具</h4>
            <p>1. 打开浏览器开发者工具 (F12)</p>
            <p>2. 查看Console面板的错误信息</p>
            <p>3. 检查Network面板的API请求</p>
            <p>4. 使用测试页面验证数据库连接</p>
        </div>

        <a href="http://localhost:8080/test" class="btn btn-secondary" target="_blank">🧪 打开系统测试页面</a>
    </div>

    <div class="test-section">
        <h2>📊 测试检查清单</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="feature-item">
                <h4>✅ 基础功能</h4>
                <p>□ 地图正常显示</p>
                <p>□ 景点列表加载</p>
                <p>□ 标记正确显示</p>
                <p>□ 模式切换正常</p>
            </div>
            
            <div class="feature-item">
                <h4>✅ 交互功能</h4>
                <p>□ 点击选择景点</p>
                <p>□ 拖拽移动标记</p>
                <p>□ 地图缩放平移</p>
                <p>□ 双击编辑景点</p>
            </div>
            
            <div class="feature-item">
                <h4>✅ 编辑功能</h4>
                <p>□ 添加新景点</p>
                <p>□ 修改景点信息</p>
                <p>□ 删除景点</p>
                <p>□ 状态切换</p>
            </div>
            
            <div class="feature-item">
                <h4>✅ 数据同步</h4>
                <p>□ 实时保存</p>
                <p>□ 数据库同步</p>
                <p>□ 界面更新</p>
                <p>□ 错误处理</p>
            </div>
        </div>
    </div>

    <div class="success">
        <h4>🎉 测试完成</h4>
        <p>如果所有功能都正常工作，恭喜您！地图编辑器已经可以投入使用了。</p>
        <p>如果遇到问题，请检查控制台错误信息或联系开发团队。</p>
    </div>

    <script>
        // 自动检查服务器状态
        async function checkServerStatus() {
            try {
                const response = await fetch('http://localhost:8080/health');
                if (response.ok) {
                    console.log('✅ 服务器运行正常');
                } else {
                    console.warn('⚠️ 服务器响应异常');
                }
            } catch (error) {
                console.error('❌ 无法连接到服务器，请确保运行 npm start');
            }
        }

        // 页面加载时检查
        document.addEventListener('DOMContentLoaded', checkServerStatus);
    </script>
</body>
</html>